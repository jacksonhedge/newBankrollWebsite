import{c as T,u as U,r as c,j as e,C as E,y as I,X as M,z as $,f as A,H as q,i as Y,T as se,I as te}from"./index-CnFB-Ezu-1733463034889.js";import{g as v,a as ae}from"./GroupService-C2sUHHuc-1733463034889.js";import{M as H}from"./mail-OLwrLDGL-1733463034889.js";import{P as J}from"./plus-B5R7HYuJ-1733463034889.js";import{C as O}from"./check-Cy8j96ut-1733463034889.js";import{U as K}from"./UserAvatar-iCmYFxOQ-1733463034889.js";import{D as le}from"./dollar-sign-o-KjJxTx-1733463034889.js";import{U as ne}from"./user-plus-DxrUvOQJ-1733463034889.js";import{C as re}from"./clock-DtCoxnid-1733463034889.js";/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=T("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=T("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=T("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),de=({groupId:x,onClose:f,onInvite:s})=>{const{currentUser:n}=U(),[r,w]=c.useState(""),[d,j]=c.useState([]),[a,m]=c.useState(!1),[S,u]=c.useState(""),[y,D]=c.useState(!1),[b,F]=c.useState(null);c.useEffect(()=>{n||u("You must be logged in to send invites")},[n]);const G=i=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i),C=i=>{if(i.preventDefault(),!!r){if(!G(r)){u("Please enter a valid email address");return}if(d.includes(r)){u("This email has already been added");return}j([...d,r]),w(""),u("")}},k=i=>{j(d.filter(h=>h!==i))},B=i=>{i.key==="Enter"&&(i.preventDefault(),C(i))},p=async i=>{if(i.preventDefault(),!n){u("You must be logged in to send invites");return}if(d.length===0&&!r){u("Please enter at least one email address");return}let h=[...d];if(r&&G(r)&&!d.includes(r)&&(h=[...h,r]),h.length===0){u("Please enter at least one valid email address");return}m(!0),u(""),D(!1),F(null);try{console.log("Sending invites to:",h);const g=await v.inviteUsers(x,h);if(console.log("Invite result:",g),g.success)D(!0),F(g),s(),setTimeout(()=>{f()},3e3);else throw new Error(g.message||"Failed to send invites")}catch(g){console.error("Error inviting users:",g),g.message.includes("authenticated")?u("Please sign in again to send invites"):g.message.includes("not found")?u("Group not found. Please refresh the page."):u(g.message||"Failed to send invites. Please try again.")}finally{m(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs(E,{className:"bg-gray-900/40 border-purple-500/20 w-[400px]",children:[e.jsxs(I,{className:"relative",children:[e.jsx("button",{onClick:f,className:"absolute right-4 top-4 text-gray-400 hover:text-white",children:e.jsx(M,{className:"w-5 h-5"})}),e.jsxs($,{className:"text-xl font-bold text-white flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),"Invite Users"]})]}),e.jsx(A,{children:e.jsxs("form",{onSubmit:p,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Email Addresses"}),e.jsxs("div",{className:"space-y-2",children:[d.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 p-2 bg-gray-800 rounded-lg",children:d.map((i,h)=>e.jsxs("div",{className:"flex items-center gap-1 bg-purple-600/30 text-white px-2 py-1 rounded-full text-sm",children:[e.jsx(ce,{className:"w-3 h-3"}),e.jsx("span",{children:i}),e.jsx("button",{type:"button",onClick:()=>k(i),className:"text-purple-300 hover:text-white",children:e.jsx(M,{className:"w-3 h-3"})})]},h))}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"email",value:r,onChange:i=>{w(i.target.value),u("")},onKeyDown:B,className:`flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg 
                      text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500
                      disabled:opacity-50 disabled:cursor-not-allowed`,placeholder:"Enter email address",disabled:a||y||!n}),e.jsx("button",{type:"button",onClick:C,disabled:!r||a||y||!n,className:`px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg 
                      transition-colors disabled:opacity-50 disabled:cursor-not-allowed`,children:e.jsx(J,{className:"w-4 h-4"})})]})]})]}),S&&e.jsxs("div",{className:"flex items-center gap-2 text-red-500 text-sm bg-red-500/10 p-2 rounded",children:[e.jsx(q,{className:"w-4 h-4"}),e.jsx("p",{children:S})]}),y&&b&&e.jsxs("div",{className:"flex items-center gap-2 text-green-500 text-sm bg-green-500/10 p-2 rounded",children:[e.jsx(O,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsxs("p",{children:["Successfully sent ",b.invitedCount," invites!"]}),b.skippedCount>0&&e.jsxs("p",{className:"text-gray-400",children:["(",b.skippedCount," already invited or members)"]})]})]}),e.jsx("button",{type:"submit",disabled:a||y||!n||d.length===0&&!r,className:`w-full py-2 px-4 rounded-lg transition-all duration-200 flex items-center justify-center gap-2
                ${a||y||!n||d.length===0&&!r?"bg-gray-600 cursor-not-allowed opacity-50":"bg-purple-600 hover:bg-purple-700"} 
                text-white font-medium`,children:a?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/20 border-t-white rounded-full animate-spin"}),"Sending..."]}):y?e.jsxs(e.Fragment,{children:[e.jsx(O,{className:"w-4 h-4"}),"Sent!"]}):n?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4"}),"Send ",d.length>0?`${d.length} Invites`:"Invite"]}):e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"w-4 h-4"}),"Please Sign In"]})})]})})]})})},oe=({group:x,onClose:f,onSubmit:s})=>{var j;const[n,r]=c.useState({description:"",amount:"",splitBetween:[]}),w=a=>{a.preventDefault(),s(n)},d=a=>{r(m=>({...m,splitBetween:m.splitBetween.includes(a)?m.splitBetween.filter(S=>S!==a):[...m.splitBetween,a]}))};return e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs(E,{className:"bg-gray-900/40 border-purple-500/20 w-[400px]",children:[e.jsxs(I,{className:"relative",children:[e.jsx("button",{onClick:f,className:"absolute right-4 top-4 text-gray-400 hover:text-white",children:e.jsx(M,{className:"w-5 h-5"})}),e.jsx($,{className:"text-xl font-bold text-white",children:"Add Expense"})]}),e.jsx(A,{children:e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Description"}),e.jsx("input",{type:"text",value:n.description,onChange:a=>r(m=>({...m,description:a.target.value})),className:`w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg 
                  text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500`,placeholder:"Enter expense description",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Amount"}),e.jsx("input",{type:"number",value:n.amount,onChange:a=>r(m=>({...m,amount:a.target.value})),className:`w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-lg 
                  text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500`,placeholder:"Enter amount",step:"0.01",min:"0",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Split Between"}),e.jsx("div",{className:"space-y-2",children:(j=x.members)==null?void 0:j.map(a=>e.jsxs("div",{onClick:()=>d(a.uid),className:`flex items-center space-x-2 p-2 rounded-lg cursor-pointer
                      ${n.splitBetween.includes(a.uid)?"bg-purple-600/20 border border-purple-500/50":"bg-gray-800 border border-gray-700 hover:border-gray-600"}`,children:[e.jsx(K,{user:a}),e.jsx("span",{className:"text-white",children:a.displayName})]},a.uid))}),n.splitBetween.length>0&&n.amount&&e.jsxs("p",{className:"text-sm text-gray-400 mt-2",children:["Split amount: $",(parseFloat(n.amount)/n.splitBetween.length).toFixed(2)," each"]})]}),e.jsx("button",{type:"submit",className:`w-full py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg 
                transition-colors`,children:"Add Expense"})]})})]})})},xe=({groupId:x,onClose:f})=>{var z,L,V;const[s,n]=c.useState(null),[r,w]=c.useState(!0),[d,j]=c.useState(""),[a,m]=c.useState(!1),[S,u]=c.useState(!1),[y,D]=c.useState(!1),[b,F]=c.useState(!1),[G,C]=c.useState(!1),[k,B]=c.useState(null),{currentUser:p}=U(),i=Y(),h=(s==null?void 0:s.ownerId)===(p==null?void 0:p.uid);c.useEffect(()=>{p&&(async()=>{try{const l=await v.getGroup(x);if(n(l),l.description)try{const o=JSON.parse(l.description);o.platform&&o.buyInAmount!==void 0&&B(o)}catch{console.log("Not a league group or invalid JSON in description")}}catch(l){console.error("Error fetching group:",l),j("Failed to load group")}finally{w(!1)}})()},[x,p]);const g=async()=>{try{await v.deleteGroup(x),i("/groups")}catch(t){console.error("Error deleting group:",t),j("Failed to delete group")}},W=async t=>{try{const l=parseFloat(t.amount);if(isNaN(l)||l<=0){alert("Please enter a valid amount");return}if(!t.description){alert("Please enter a description");return}const o=t.splitBetween.length>0?t.splitBetween:(s==null?void 0:s.members.map(P=>P.uid))||[];await ae.addExpense(x,t.description,l,(p==null?void 0:p.uid)||"",o);const N=await v.getGroup(x);n(N),u(!1)}catch(l){console.error("Error adding expense:",l),j("Failed to add expense")}},X=async t=>{try{if(!s)return;const l=s.pendingMembers.filter(N=>N.identifier!==t);await v.updateGroup(x,{pendingMembers:l});const o=await v.getGroup(x);n(o)}catch(l){console.error("Error canceling invite:",l),j("Failed to cancel invite")}},Q=()=>k?e.jsxs("div",{className:"bg-purple-900/30 rounded-lg p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(se,{className:"w-5 h-5 text-yellow-500"}),e.jsx("h3",{className:"text-white font-medium",children:"League Details"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-purple-900/20 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Buy-in Amount"}),e.jsxs("p",{className:"text-lg font-medium text-white",children:["$",k.buyInAmount]})]}),e.jsxs("div",{className:"bg-purple-900/20 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total Teams"}),e.jsx("p",{className:"text-lg font-medium text-white",children:k.totalTeams})]}),e.jsxs("div",{className:"col-span-2 bg-purple-900/20 p-3 rounded-lg",children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Total Expense"}),e.jsxs("p",{className:"text-lg font-medium text-white",children:["$",k.totalExpense]})]})]})]}):null,Z=()=>{var t;return(t=s==null?void 0:s.pendingMembers)!=null&&t.length?e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Pending Invites"}),e.jsx("div",{className:"space-y-2",children:s.pendingMembers.map(l=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-800/50 p-2 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(re,{className:"w-4 h-4 text-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white text-sm",children:l.identifier}),e.jsxs("p",{className:"text-xs text-gray-400",children:["Invited ",new Date(l.invitedAt).toLocaleDateString()]})]})]}),h&&e.jsx("button",{onClick:()=>X(l.identifier),className:"text-red-500 hover:text-red-400 p-1",title:"Cancel invite",children:e.jsx(M,{className:"w-4 h-4"})})]},l.identifier))})]}):null},_=()=>{var t,l;return(l=(t=s==null?void 0:s.wallet)==null?void 0:t.expenses)!=null&&l.length?e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Recent Expenses"}),e.jsx("div",{className:"space-y-2",children:s.wallet.expenses.map(o=>{const N=s.members.find(ee=>ee.uid===o.paidBy),P=o.amount/o.splitBetween.length;return e.jsx("div",{className:"p-3 bg-gray-800 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:o.description}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Paid by ",(N==null?void 0:N.displayName)||"Unknown"]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["Split between ",o.splitBetween.length," members ($",P.toFixed(2)," each)"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"text-white font-medium",children:["$",o.amount.toFixed(2)]}),e.jsx("p",{className:"text-xs text-gray-400",children:new Date(o.timestamp).toLocaleDateString()})]})]})},o.id)})})]}):e.jsx("div",{className:"text-center text-gray-400 py-4",children:"No expenses yet"})};return r?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsx(E,{className:"bg-gray-900/40 border-purple-500/20",children:e.jsx(A,{children:e.jsx("p",{className:"text-white",children:"Loading..."})})})}):d?e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsx(E,{className:"bg-gray-900/40 border-purple-500/20",children:e.jsx(A,{children:e.jsx("p",{className:"text-red-500",children:d})})})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs(E,{className:"bg-gray-900/40 border-purple-500/20 w-[400px] max-h-[80vh] overflow-y-auto",children:[e.jsxs(I,{className:"relative",children:[e.jsxs("div",{className:"absolute right-4 top-4 flex items-center space-x-2",children:[h&&e.jsx("button",{onClick:()=>F(!b),className:"text-gray-400 hover:text-white",children:e.jsx(ie,{className:"w-5 h-5"})}),e.jsx("button",{onClick:f,className:"text-gray-400 hover:text-white",children:e.jsx(M,{className:"w-5 h-5"})})]}),e.jsxs($,{className:"text-xl font-bold text-white flex items-center space-x-2",children:[e.jsx("span",{className:"text-2xl",children:(s==null?void 0:s.emoji)||"ðŸ‘¥"}),e.jsx("span",{children:s==null?void 0:s.name})]})]}),e.jsxs(A,{className:"space-y-6",children:[Q(),b&&h&&e.jsx("div",{className:"bg-gray-800 rounded-lg p-4 space-y-2",children:e.jsxs("button",{onClick:()=>C(!0),className:`w-full py-2 px-4 bg-red-600 hover:bg-red-700 text-white rounded-lg 
                    transition-colors flex items-center justify-center space-x-2`,children:[e.jsx(R,{className:"w-5 h-5"}),e.jsx("span",{children:"Delete Group"})]})}),G&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 space-y-4",children:[e.jsx("p",{className:"text-white text-center",children:"Are you sure you want to delete this group?"}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx("button",{onClick:g,className:"py-2 px-4 bg-red-600 hover:bg-red-700 text-white rounded-lg",children:"Yes, Delete"}),e.jsx("button",{onClick:()=>C(!1),className:"py-2 px-4 bg-gray-600 hover:bg-gray-700 text-white rounded-lg",children:"Cancel"})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-4xl font-bold text-white",children:["$",((L=(z=s==null?void 0:s.wallet)==null?void 0:z.cashBalance)==null?void 0:L.toFixed(2))||"0.00"]}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Group Balance"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>u(!0),className:`flex-1 py-3 px-4 bg-green-600 hover:bg-green-700 text-white rounded-lg 
                  transition-colors flex items-center justify-center space-x-2`,children:[e.jsx(J,{className:"w-5 h-5"}),e.jsx("span",{children:"Add expense"})]}),h&&e.jsxs("button",{onClick:()=>D(!0),className:`flex-1 py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white rounded-lg 
                    transition-colors flex items-center justify-center space-x-2`,children:[e.jsx(le,{className:"w-5 h-5"}),e.jsx("span",{children:"Add funds"})]}),e.jsxs("button",{onClick:()=>m(!0),className:`flex-1 py-3 px-4 bg-purple-600 hover:bg-purple-700 text-white rounded-lg 
                  transition-colors flex items-center justify-center space-x-2`,children:[e.jsx(ne,{className:"w-5 h-5"}),e.jsx("span",{children:"Invite"})]})]}),_(),Z(),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-400",children:"Members"}),e.jsx("div",{className:"space-y-2",children:(V=s==null?void 0:s.members)==null?void 0:V.map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{user:t}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white",children:t.displayName}),t.uid===s.ownerId&&e.jsx("p",{className:"text-xs text-gray-400",children:"Owner"})]})]}),h&&t.uid!==(p==null?void 0:p.uid)&&e.jsx("button",{className:"text-red-500 hover:text-red-400",children:e.jsx(R,{className:"w-4 h-4"})})]},t.uid))})]})]})]})}),a&&e.jsx(de,{groupId:x,onClose:()=>m(!1),onInvite:async()=>{const t=await v.getGroup(x);n(t),m(!1)}}),S&&s&&e.jsx(oe,{group:s,onClose:()=>u(!1),onSubmit:W})]})},Ne=()=>{const{groupId:x}=te(),f=Y(),s=()=>{f("/groups")};return x?e.jsx(xe,{groupId:x,onClose:s}):null};export{Ne as default};
