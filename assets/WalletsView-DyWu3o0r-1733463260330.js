var R=Object.defineProperty;var G=(n,l,r)=>l in n?R(n,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[l]=r;var A=(n,l,r)=>G(n,typeof l!="symbol"?l+"":l,r);import{c as B,d as L,a as F,q as P,w as I,o as M,g as q,u as D,b as E,r as d,n as N,j as e,X as H,e as z,T as O,P as w,C as S,f as T,h as U,L as _}from"./index-D9DuqCFY-1733463260330.js";import{G as $}from"./gift-BtTy-PU4-1733463260330.js";import{P as X}from"./plus-zWYWoahp-1733463260330.js";/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=B("ArrowDownUp",[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"m21 8-4-4-4 4",key:"1c9v7m"}],["path",{d:"M17 4v16",key:"7dpous"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=B("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=B("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=B("LayoutGrid",[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=B("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.363.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=B("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);class ee{constructor(){A(this,"firestore");if(!L)throw new Error("Firestore must be initialized before using TransactionService");this.firestore=L}async getWalletTransactions(l,r){try{const o=F(this.firestore,"wallet_transactions"),u=P(o,I("userId","==",l),I("platformId","==",r),M("timestamp","desc"));return(await q(u)).docs.map(f=>({...f.data(),id:f.id}))}catch(o){throw console.error("Error fetching wallet transactions:",o),o}}async getAllUserTransactions(l){try{const r=F(this.firestore,"wallet_transactions"),o=P(r,I("userId","==",l),M("timestamp","desc"));return(await q(o)).docs.map(m=>({...m.data(),id:m.id}))}catch(r){throw console.error("Error fetching user transactions:",r),r}}}const V=new ee,se=({wallet:n,onClose:l})=>{const{currentUser:r}=D(),{wallets:o,refreshWallet:u}=E(),[m,f]=d.useState(!1),[v,i]=d.useState(""),[p,x]=d.useState(!0),[h,y]=d.useState([]),[k,j]=d.useState(!1);d.useEffect(()=>{if(console.log("WalletDetailsModal mounted"),console.log("Modal wallet prop:",n),o!=null&&o.subWallets){const s=o.subWallets[n.platformId];console.log("SubWallet from context:",s)}},[n,o]),d.useEffect(()=>{(async()=>{if(!(!r||!n.platformId)){j(!0);try{const a=await V.getWalletTransactions(r.uid,n.platformId);y(a)}catch(a){console.error("Error fetching transactions:",a),N.error("Failed to load transaction history")}finally{j(!1)}}})()},[r,n.platformId]),d.useEffect(()=>{const s=a=>{a.key==="Escape"&&l()};return document.body.style.overflow="hidden",window.addEventListener("keydown",s),()=>{document.body.style.overflow="unset",window.removeEventListener("keydown",s)}},[l]);const b=s=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(s||0),c=s=>{if(!s)return"";const a=s.toDate?s.toDate():new Date(s);return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}).format(a)},t=async()=>{if(!r){N.error("Please sign in to transfer bonus.");return}if(!n.platformId){N.error("Invalid wallet selected");return}const s=parseFloat(v);if(isNaN(s)||s<=0){N.error("Please enter a valid amount");return}if(s>(r.bonusBalance||0)){N.error("Insufficient bonus balance");return}f(!0);try{await z.transferBonusToSubWallet(r.uid,n.platformId,s),await u();const a=await V.getWalletTransactions(r.uid,n.platformId);y(a),N.success(`Successfully transferred ${b(s)} to ${n.name}`),i(""),x(!0)}catch(a){console.error("Error transferring bonus:",a),N.error("Failed to transfer bonus. Please try again.")}finally{f(!1)}};return n.platformId?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/75 backdrop-blur-sm z-50",onClick:l}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:s=>s.stopPropagation(),children:e.jsx("div",{className:"bg-[#1C2333] rounded-xl shadow-xl w-full max-w-lg mx-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-purple-900/20 p-2 rounded-xl",children:e.jsx("img",{src:n.logo,alt:n.name,className:"w-10 h-10 object-contain"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:n.name}),e.jsx("p",{className:"text-sm text-gray-400",children:"Wallet Details"})]})]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-300 transition-colors",children:e.jsx(H,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-base font-medium text-white mb-2",children:[n.name," Bonus Balance"]}),e.jsx("p",{className:"text-2xl font-bold text-purple-400",children:b(n.totalBonusBalance||0)})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-base font-medium text-white mb-2",children:"Available Bonus Balance"}),e.jsx("p",{className:"text-2xl font-bold text-green-500 mb-4",children:b((r==null?void 0:r.bonusBalance)||0)}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"number",value:v,onChange:s=>i(s.target.value),placeholder:"Enter amount to transfer",className:"w-full px-3 py-2 bg-gray-700/50 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500",disabled:m}),e.jsx("button",{onClick:t,disabled:m||!v,className:"w-full flex items-center justify-center px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:m?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"Transferring..."]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-4 h-4 mr-2"}),"Transfer Bonus"]})})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-base font-medium text-white",children:"Transaction History"}),e.jsx("button",{onClick:()=>x(!p),className:"text-sm text-purple-400 hover:text-purple-300",children:p?"Hide":"Show"})]}),p&&e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:k?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(C,{className:"w-6 h-6 animate-spin text-purple-400"})}):h.length>0?h.map(s=>e.jsxs("div",{className:"flex justify-between items-center bg-gray-700/20 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Y,{className:"w-4 h-4 text-purple-400"}),e.jsx("p",{className:"text-sm text-white",children:s.description})]}),e.jsx("p",{className:"text-xs text-gray-400",children:c(s.timestamp)})]}),e.jsx("p",{className:"text-sm font-medium text-green-500",children:b(s.amount)})]},s.id)):e.jsx("p",{className:"text-sm text-gray-400",children:"No transactions yet"})})]}),e.jsxs("button",{onClick:()=>{},className:"w-full flex items-center justify-between px-3 py-2 bg-gray-700/50 hover:bg-gray-700 text-white rounded-lg transition-colors",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"h-4 w-4 text-yellow-500"}),e.jsx("span",{children:"View Available Challenges"})]}),e.jsx(Z,{className:"h-4 w-4"})]})]})})})]}):(console.error("No platformId provided to WalletDetailsModal"),null)};function te({onClose:n}){var c;const{currentUser:l}=D(),{wallets:r,refreshWallet:o}=E(),[u,m]=d.useState(""),[f,v]=d.useState(""),[i,p]=d.useState(""),[x,h]=d.useState(!1),[y,k]=d.useState(!1),j=Object.entries(w).map(([t,s])=>{var a;return{id:t,name:s.name,logo:s.logo,wallet:((a=r==null?void 0:r.subWallets)==null?void 0:a[t])||null}});console.log("=== BonusTransferDialogue Debug ==="),console.log("Available wallets:",j);const b=async t=>{var a;if(t.preventDefault(),p(""),h(!0),!u){p("Please select a platform"),h(!1);return}const s=parseFloat(f);if(isNaN(s)||s<=0){p("Please enter a valid amount"),h(!1);return}if(s>((l==null?void 0:l.bonusBalance)||0)){p("Insufficient bonus balance"),h(!1);return}try{console.log("Starting bonus transfer:",{userId:l.uid,platformId:u,amount:s}),await z.transferBonusToSubWallet(l.uid,u,s),console.log("Bonus transfer successful, refreshing wallet data"),await o(),console.log("Updated wallet data:",{selectedPlatform:u,updatedWallet:(a=r==null?void 0:r.subWallets)==null?void 0:a[u]}),k(!0),setTimeout(()=>{n()},2e3)}catch(g){console.error("Error during bonus transfer:",g),p(g.message||"Failed to transfer bonus")}finally{h(!1)}};return y?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsx(S,{className:"max-w-md w-full bg-white",children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-green-500 text-2xl mb-4",children:"✓"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Transfer Successful!"}),e.jsx("p",{className:"text-gray-600",children:"Your bonus has been transferred successfully."})]})})})}):e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4",children:e.jsx(S,{className:"max-w-md w-full bg-white",children:e.jsxs(T,{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Transfer Bonus"}),e.jsx("button",{onClick:n,className:"text-gray-500 hover:text-gray-700",children:"×"})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("p",{className:"text-sm text-gray-600 mb-2",children:["Available Bonus Balance: $",((c=l==null?void 0:l.bonusBalance)==null?void 0:c.toFixed(2))||"0.00"]})}),e.jsxs("form",{onSubmit:b,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Platform"}),e.jsxs("select",{value:u,onChange:t=>{const s=t.target.value;m(s),console.log("Selected platform:",s)},className:"w-full p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",disabled:x,children:[e.jsx("option",{value:"",children:"Select a platform"}),j.map(({id:t,name:s})=>e.jsx("option",{value:t,children:s},t))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Amount"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-3 top-2 text-gray-500",children:"$"}),e.jsx("input",{type:"number",value:f,onChange:t=>v(t.target.value),className:"w-full p-2 pl-8 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00",min:"0",step:"0.01",disabled:x})]})]}),i&&e.jsx("div",{className:"mb-4 text-red-500 text-sm",children:i}),e.jsx("button",{type:"submit",className:`w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 ${x?"opacity-50 cursor-not-allowed":""}`,disabled:x,children:x?"Transferring...":"Transfer Bonus"})]})]})})})}const ce=()=>{const[n,l]=d.useState("list"),[r,o]=d.useState(null),[u,m]=d.useState(!1),[f,v]=d.useState(null),{wallets:i,refreshWallet:p}=E(),{currentUser:x}=D(),h=c=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(c||0),y=c=>{var t;return(t=c==null?void 0:c.bonusBalances)!=null&&t.length?c.bonusBalances.reduce((s,a)=>a.status==="active"?s+(a.amount||0):s,0):0},k=c=>{var s;const t=(s=i==null?void 0:i.subWallets)==null?void 0:s[c];if(t){const a={...t,platformId:c,name:t.name||w[c].name,logo:t.logo||w[c].logo,cashBalance:t.cashBalance||0,totalBonusBalance:y(t),bonusBalances:t.bonusBalances||[],status:t.status||"active",connected:t.connected||!0,created:!0,lastUpdated:t.lastUpdated||new Date};o(a)}else{const a=U(c,w[c].name,w[c].logo);o(a)}},j=()=>{o(null)};if(!x||!i)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(C,{className:"w-12 h-12 animate-spin text-purple-600"})});const b=()=>{const c=Object.entries(w).map(([t,s])=>{var g;const a=(g=i==null?void 0:i.subWallets)==null?void 0:g[t];if(a){const W=y(a);return{platformId:t,name:a.name||s.name,logo:a.logo||s.logo,cashBalance:a.cashBalance||0,totalBonusBalance:W,bonusBalances:a.bonusBalances||[],status:a.status||"active",connected:a.connected||!0,created:!0,loading:a.loading||!1,lastUpdated:a.lastUpdated||new Date}}return U(t,s.name,s.logo)});return e.jsxs("div",{className:"space-y-6",children:[e.jsx(S,{className:"bg-gray-900/40 border-purple-500/20",children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsx("img",{src:i.bankroll.logo,alt:"Bankroll",className:"w-20 h-20 object-contain"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white mb-2",children:"Bankroll Balance (withdrawable)"}),e.jsx("p",{className:"text-2xl font-bold text-purple-400",children:h(x.dwollaBalance||0)}),e.jsxs("p",{className:"text-sm text-gray-400 mt-1",children:["Bonus Balance: ",h(x.bonusBalance||0)]})]})]}),e.jsxs("button",{onClick:()=>m(!0),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center transition-colors",children:[e.jsx($,{className:"w-5 h-5 mr-2"}),"Transfer Bonus"]})]})})}),e.jsxs("div",{className:"space-y-4",children:[c.map(t=>{var a,g,W;(g=(a=i==null?void 0:i.subWallets)==null?void 0:a[t.platformId])!=null&&g.created;const s=((W=t.bonusBalances)==null?void 0:W.length)>0;return e.jsx(S,{className:"bg-gray-900/40 border-gray-700 hover:border-purple-500/20",children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"p-2 rounded-xl bg-gray-700/50",children:e.jsx("img",{src:t.logo,alt:t.name,className:"w-12 h-12 object-contain"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Bonus Balance: ",h(t.totalBonusBalance)]}),s&&e.jsx("p",{className:"text-xs text-purple-400 mt-1",children:"Click View to see transaction history"})]})]}),t.loading||f===t.platformId?e.jsxs("div",{className:"bg-purple-600 text-white px-4 py-2 rounded-lg flex items-center",children:[e.jsx(C,{className:"w-5 h-5 mr-2 animate-spin"}),f===t.platformId?"Creating...":"Loading..."]}):e.jsxs("button",{onClick:()=>k(t.platformId),className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center transition-colors",children:[e.jsx(J,{className:"w-5 h-5 mr-2"}),"View"]})]})})},t.platformId)}),e.jsx(_,{to:"/partners",children:e.jsx(S,{className:"bg-gray-900/40 border-gray-700 hover:border-purple-500/20 transition-colors",children:e.jsx(T,{className:"p-6",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-gray-700/50 flex items-center justify-center",children:e.jsx(X,{className:"w-6 h-6 text-gray-400"})}),e.jsx("p",{className:"text-lg font-medium text-gray-400",children:"Add Platform"})]})})})})]})]})};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-8",children:"Wallets"}),e.jsxs("div",{className:"flex justify-end space-x-2 mb-6",children:[e.jsx("button",{onClick:()=>l("tree"),className:`p-2.5 rounded-lg transition-colors ${n==="tree"?"bg-purple-600 text-white":"bg-gray-900/40 text-gray-300 hover:bg-purple-900/20 border border-gray-700"}`,children:e.jsx(K,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>l("list"),className:`p-2.5 rounded-lg transition-colors ${n==="list"?"bg-purple-600 text-white":"bg-gray-900/40 text-gray-300 hover:bg-purple-900/20 border border-gray-700"}`,children:e.jsx(Q,{className:"h-5 w-5"})})]}),n==="tree"?e.jsx("div",{className:"relative min-h-[800px] flex flex-col items-center bg-gray-900 p-6 rounded-lg",children:e.jsx("div",{className:"text-gray-400",children:"Tree view coming soon..."})}):e.jsx(b,{}),r&&e.jsx(se,{wallet:r,onClose:j}),u&&e.jsx(te,{onClose:()=>m(!1)})]})};export{ce as default};
