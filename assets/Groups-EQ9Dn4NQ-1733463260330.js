import{r as n,u as g,i as b,j as e}from"./index-D9DuqCFY-1733463260330.js";import{g as p,e as j}from"./GroupService-B1OGUZ2e-1733463260330.js";import{U as v}from"./UserAvatar-DkLeIt46-1733463260330.js";const N=()=>{const[l,d]=n.useState([]),[u,x]=n.useState(!0),{currentUser:i}=g(),o=b();return n.useEffect(()=>{if(!i){d([]),x(!1);return}(async()=>{try{const r=(await p.getUserGroups(i.uid)||[]).map(s=>({id:s.id,name:s.name,description:s.description,emoji:s.emoji,ownerId:s.ownerId,owner:s.owner,members:s.members||[],memberIds:s.memberIds||[],pendingMembers:s.pendingMembers||[],dateCreated:s.dateCreated,isHidden:s.isHidden||!1,visibility:s.visibility||"private",inviteLink:s.inviteLink,status:s.status||"active",wallet:s.wallet}));d(r)}catch(a){console.error("Error fetching groups:",a),d([])}finally{x(!1)}})()},[i]),u?e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-gray-500",children:"Loading groups..."})}):l.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("p",{className:"text-gray-500",children:"No groups found"}),e.jsx("button",{onClick:()=>o("/create-group"),className:"mt-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Create a Group"})]}):e.jsx("div",{className:"space-y-4",children:l.map(t=>{var a;return e.jsx("div",{className:"rounded-lg border border-gray-200 bg-gray-900/40 border-purple-500/20 cursor-pointer hover:bg-gray-900/60 shadow-sm",onClick:()=>o(`/groups/${t.id}`),children:e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{className:"text-2xl",children:t.emoji||"ðŸ‘¥"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:t.name}),t.description&&e.jsx("p",{className:"text-sm text-gray-400",children:t.description})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[(a=t.members)==null?void 0:a.slice(0,3).map(r=>e.jsx(v,{user:r},r.uid)),t.members&&t.members.length>3&&e.jsxs("div",{className:"w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-sm text-white",children:["+",t.members.length-3]})]})]}),t.wallet&&e.jsxs("div",{className:"mt-2 text-sm text-gray-400",children:["Balance: $",t.wallet.cashBalance.toFixed(2)]})]})},t.id)})})},w=()=>{const[l,d]=n.useState(""),[u,x]=n.useState(""),[i,o]=n.useState(!1),[t,a]=n.useState(""),{currentUser:r}=g(),s=b(),f=async c=>{if(c.preventDefault(),!r){a("You must be logged in to create a group.");return}try{o(!0),a("");const h={name:l,description:u,emoji:"ðŸ‘¥",pendingMembers:[],visibility:"private"},m=await p.createGroup(h,{uid:r.uid,displayName:r.displayName||"",photoURL:r.photoURL,firstName:r.firstName||"",lastName:r.lastName||"",username:r.username||""});if(m&&m.id){try{await j.sendGroupInvite(m.id,m.name,"jackson@hedgepayments.com"),console.log("Test email sent successfully")}catch(y){console.error("Failed to send test email:",y)}s(`/groups/${m.id}`)}else throw new Error("Failed to create group: Missing group ID")}catch(h){console.error("Error creating group:",h),a("Failed to create group. Please try again.")}finally{o(!1)}};return e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[t&&e.jsx("div",{className:"text-red-500 text-sm",children:t}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Group Name"}),e.jsx("input",{type:"text",id:"name",value:l,onChange:c=>d(c.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",required:!0,minLength:3,maxLength:50})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description (Optional)"}),e.jsx("textarea",{id:"description",value:u,onChange:c=>x(c.target.value),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white",rows:3,maxLength:200})]}),e.jsx("button",{type:"submit",disabled:i,className:`w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 ${i?"opacity-50 cursor-not-allowed":""}`,children:i?"Creating...":"Create Group"})]})},L=()=>{const{currentUser:l}=g();return e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Groups"})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:"Your Groups"}),e.jsx(N,{})]})}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 text-gray-900 dark:text-white",children:"Create New Group"}),e.jsx(w,{})]})})]})]})};export{L as default};
